"use strict";function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var vm=new Vue({el:"#app",data:function(){return{thresholdInfo:{major:{credit:0,needCredit:68,course:[]},elective:{credit:0,needCredit:32,course:[]},general:{credit:0,needCredit:30,course:[]},sport:{credit:0,needCredit:4,course:[]},other:{credit:0,needCredit:0,course:[]}},otherThreshold:{service:!0,english:!1},circleOption:{animation:1,animationStep:5,foregroundBorderWidth:5,backgroundBorderWidth:1,iconColor:"#3498DB",iconSize:"40",iconPosition:"middle"},creditSummary:{},courseCode:{},subjectTitle:"",subjectList:[],activePage:-1,tableView:9,studentId:"",studentPw:"",studentName:"",studentDept:""}},mounted:function(){var t=this;setTimeout(function(){_.isUndefined(window.localStorage.creditSummary)?t.activePage=0:(t.activePage=1,t.loadStorage(),t.progressInit())},500)},computed:{totCredit:function(){var t=0;return _.each(this.thresholdInfo,function(e){t+=e.credit}),t-=this.thresholdInfo.sport.credit,t-=this.thresholdInfo.other.credit},totNeedCredit:function(){var t=0;return _.each(this.thresholdInfo,function(e){t+=e.needCredit}),t-=this.thresholdInfo.sport.needCredit},serviceGap:function(){return this.otherThreshold.service?"PASS":"Not PASS"},englishGap:function(){return this.otherThreshold.english?"PASS":"Not PASS"},navTitle:function(){return 1===this.activePage?"畢業學分統計":2===this.activePage?"畢業學分列表":3===this.activePage?"課表":4===this.activePage?"個人資料":5===this.activePage?"項目列表":void 0},totPersent:function(){var t=(this.totCredit/this.totNeedCredit).toFixed(2).toString();return t>=1&&(t=1),100*t+"%"},majorPersent:function(){var t=(this.thresholdInfo.major.credit/this.thresholdInfo.major.needCredit).toFixed(2).toString();return t>=1&&(t=1),100*t+"%"},electivePersent:function(){var t=(this.thresholdInfo.elective.credit/this.thresholdInfo.elective.needCredit).toFixed(2).toString();return t>=1&&(t=1),100*t+"%"},generalPersent:function(){var t=(this.thresholdInfo.general.credit/this.thresholdInfo.general.needCredit).toFixed(2).toString();return t>=1&&(t=1),100*t+"%"},sportPersent:function(){var t=(this.thresholdInfo.sport.credit/this.thresholdInfo.sport.needCredit).toFixed(2).toString();return t>=1&&(t=1),100*t+"%"}},methods:{getData:function(t){var e=this;_.each(t,function(t){var o=_.toString(t["學年"])+_.toString(t["學期"]),r=t["課程別"];_.has(e.creditSummary,[o,"total"])||_.setWith(e.creditSummary,[o,"total"],[],Object),_.has(e.creditSummary,[o,r])||_.setWith(e.creditSummary,[o,r],[],Object),e.creditSummary[o].total.push(t),e.creditSummary[o][r].push(t)}),_.each(this.creditSummary,function(t,o){var r=0,i=0;_.each(e.creditSummary[o].total,function(t){var e=_.parseInt(t["畢業學分"]),o=_.parseInt(t["成績"]);r+=e,o>=60&&(i+=e)}),e.creditSummary[o].credits=r,e.creditSummary[o].getCredits=i}),this.calcCredit(),this.saveToStorage()},calcCredit:function(){var t=this;$.each(this.creditSummary,function(e,o){$.each(o.total,function(e,o){var r=o["課程分類"],i=o["課程名稱"];if("英文能力檢定及輔導"===i)o["成績"]>=60&&(t.otherThreshold.english=!0);else if("服務學習"===r)o["成績"]<60&&(t.otherThreshold.service=!1);else{var n=o["課程別"],s=void 0;s="通"===n||"大一英文"===i||"大學國文"===i?t.thresholdInfo.general:"必"===n?t.thresholdInfo.major:"選"===n?t.thresholdInfo.elective:"體"===n?t.thresholdInfo.sport:t.thresholdInfo.other,o["成績"]>=60&&(s.credit+=_.parseInt(o["畢業學分"])),s.course.push(o)}})}),this.progressInit()},calcPercent:function(t){var e=0,o=0,r=0;"tot"===t?(_.each(this.thresholdInfo,function(t){o+=t.credit}),_.each(this.thresholdInfo,function(t){r+=t.needCredit})):(o=this.thresholdInfo[t].credit,r=this.thresholdInfo[t].needCredit);var i=o/r*100;return e=_.isNaN(i)||0===i?1:i,parseInt(e)},progressInit:function(){var t=this;setTimeout(function(){t.progressSetting("tot"),$.each(t.thresholdInfo,function(e,o){t.progressSetting(e)})},50)},progressSetting:function(t){var e,o="";"tot"===t?o="f19d":"major"===t?o="f024":"elective"===t?o="f11d":"general"===t?o="f02d":"sport"===t&&(o="f1e3"),$("#"+t+" .circle-progress").circliful((e={animation:1,animationStep:5,foregroundBorderWidth:5,backgroundBorderWidth:1,percent:50,iconColor:"#3498DB",iconSize:"40",iconPosition:"middle"},_defineProperty(e,"percent",this.calcPercent(t)),_defineProperty(e,"icon",o),e))},switchPage:function(t){this.activePage!==t&&(this.activePage=t,window.scrollTo(0,0),1===t&&this.progressInit())},editNeedCredit:function(t,e){var o=this;e.stopPropagation(),swal({title:"修改畢業"+t+"畢業學分",input:"text",showCancelButton:!0,closeOnConfirm:!1,animation:!0,inputPlaceholder:"畢業"+t+"畢業學分"}).then(function(e){var r=_.parseInt(e);if(_.isNaN(r))swal("錯誤","請填入正確數字","error");else{if(!1===e)return!1;if(_.isNaN(r)||!(r>0))return swal.showInputError("請填寫正確數值!"),!1;"必修"===t?o.thresholdInfo.major.needCredit=r:"選修"===t&&(o.thresholdInfo.elective.needCredit=r),swal("修改成功","已經將畢業"+t+"畢業學分修改為"+r+"畢業學分","success")}})},getCourseInfo:function(t){var e='<ul class="courseInfo"><li>學年：'+t["學年"]+"</li><li>學期："+t["學期"]+"</li><li>選課號碼："+t["選課號碼"]+"</li><li>課程名稱："+t["課程名稱"]+"</li><li>開課系所："+t["開課系所"]+"</li><li>畢業學分："+t["畢業學分"]+"</li><li>成績："+t["成績"]+"</li></ul>";swal({title:"詳細資料",html:e})},showCourseList:function(){$("#totCourseList").modal()},showCourseType:function(t){this.switchSubject(t),$("#courseList").modal()},showLogoutMsg:function(){var t=this;swal({title:"Are you sure?",text:"你確定要登出系統嗎",type:"question",showCancelButton:!0}).then(function(){t.logout()})},showCourseSetting:function(t,e){var o=this,r={major:"必修",elective:"選修",general:"通識",sport:"體育",other:"其他"},i={"必修":"major","選修":"elective","通識":"general","體育":"sport","其他":"other"}[this.subjectTitle];delete r[i];var n=new Promise(function(t){t(r)});swal({title:"將 "+t+" 移動至",input:"radio",inputOptions:n,inputValidator:function(t){return new Promise(function(e,o){t?e():o("You need to select something!")})}}).then(function(n){var s=_.findKey(o.thresholdInfo[i].course,{"選課號碼":_.toString(e)});o.thresholdInfo[n].course.push(o.thresholdInfo[i].course[s]),o.thresholdInfo[i].course[s]["成績"]>=60&&(o.thresholdInfo[i].credit-=o.thresholdInfo[i].course[s]["畢業學分"],o.thresholdInfo[n].credit+=o.thresholdInfo[i].course[s]["畢業學分"]),o.thresholdInfo[i].course.splice(s,1),swal({type:"success",html:"你已經將 "+t+" 移動至 "+r[n]+" 課程"})})},showList:function(t){this.activePage=5,this.switchSubject(t)},switchSubject:function(t){this.subjectList=this.thresholdInfo[t],"major"===t?this.subjectTitle="必修":"elective"===t?this.subjectTitle="選修":"general"===t?this.subjectTitle="通識":"sport"===t?this.subjectTitle="體育":"other"===t&&(this.subjectTitle="其他")},saveMoveSol:function(){var t=this;swal({title:"Are you sure?",text:"你確定要儲存搬移後的內容嗎",type:"question",showCancelButton:!0}).then(function(){t.saveToStorage()})},parseCourse:function(){var t=this,e=_.map(Array(13),function(){return _.map(Array(5),function(){return[{},0]})}),o=_.max(_.keys(this.creditSummary));$.each(this.creditSummary[o].total,function(o,r){var i=r["選課號碼"],n=t.courseCode[i];$.each(n.time_parsed,function(t,o){$.each(o.time,function(t,r){var i=o.day;e[r-1][i-1]=n.title_parsed.zh_TW})})}),this.timeTable=e},login:function(t){var e=this;t.preventDefault();var o={id:this.studentId,pw:this.studentPw};$("#login button").fadeOut(),$(".loading").css("opacity",1),$.post("https://login.hsingpicking.com.tw/",o,function(t){var o=JSON.parse(t);"error"!==t&&""!==o.studentName?(e.activePage=1,e.studentName=o.studentName,e.studentDept=o.studentDept,e.getData(o.courseList)):(e.studentId="",e.studentPw="",sweetAlert("Oops...","請確認學號及密碼是否正確","error")),$("#login button").show(),$(".loading").css("opacity",0)}).fail(function(){sweetAlert("Oops...","可能有什麼地方出錯了，請再重新確認網路狀況再登入，如無法排除請洽粉絲專業回報問提","error"),$("#login button").show(),$(".loading").css("opacity",0)})},showAbout:function(){$("#about").modal()},showDownload:function(){$("#download").modal()},logout:function(){this.activePage=0,this.thresholdInfo={major:{credit:0,needCredit:68,course:[]},elective:{credit:0,needCredit:32,course:[]},general:{credit:0,needCredit:30,course:[]},sport:{credit:0,needCredit:4,course:[]},other:{credit:0,needCredit:0,course:[]}},this.otherThreshold={service:!0,english:!1},this.creditSummary={},this.studentId="",this.studentPw="",this.clearStorage()},saveToStorage:function(){window.localStorage.studentId=JSON.stringify(this.studentId),window.localStorage.studentName=JSON.stringify(this.studentName),window.localStorage.studentDept=JSON.stringify(this.studentDept),window.localStorage.creditSummary=JSON.stringify(this.creditSummary),window.localStorage.thresholdInfo=JSON.stringify(this.thresholdInfo),window.localStorage.otherThreshold=JSON.stringify(this.otherThreshold)},loadStorage:function(){this.studentId=JSON.parse(window.localStorage.studentId),this.studentName=JSON.parse(window.localStorage.studentName),this.studentDept=JSON.parse(window.localStorage.studentDept),this.creditSummary=JSON.parse(window.localStorage.creditSummary),this.thresholdInfo=JSON.parse(window.localStorage.thresholdInfo),this.otherThreshold=JSON.parse(window.localStorage.otherThreshold)},clearStorage:function(){localStorage.removeItem("studentId"),localStorage.removeItem("studentName"),localStorage.removeItem("studentDept"),localStorage.removeItem("creditSummary"),localStorage.removeItem("thresholdInfo"),localStorage.removeItem("otherThreshold")}}});